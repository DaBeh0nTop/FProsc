<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MLBB Email Code Login — Demo UI</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg1: #0f1226; --bg2: #121a3a; --bg3: #0a0f25;
      --card: #151a38; --ink: #e7ecff; --muted: #93a4ff;
      --accent: #7aa1ff; --accent-2: #6ef3ff; --good:#38d39f; --warn:#ffd66e; --bad:#ff7aa1;
      --ring: rgba(110, 243, 255, .35);
    }
    * { box-sizing: border-box }
    html,body { height: 100% }
    body {
      margin: 0; font-family: Poppins, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: radial-gradient(1200px 800px at 80% -10%, rgba(110,243,255,.25), transparent 60%),
                  radial-gradient(800px 600px at -10% 110%, rgba(122,161,255,.20), transparent 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg2) 60%, var(--bg3));
    }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 32px }
    .app {
      width: 100%; max-width: 760px; position: relative;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 24px; padding: 28px; box-shadow: 0 12px 40px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
      backdrop-filter: blur(8px);
    }
    .title { display: flex; align-items: center; gap: 12px; margin-bottom: 20px }
    .badge { font-size: 12px; padding: 6px 10px; border-radius: 999px; background: rgba(122,161,255,.12); color: var(--muted); border: 1px solid rgba(122,161,255,.25) }
    h1 { font-size: clamp(20px, 2.6vw, 28px); margin: 0; letter-spacing: .3px }
    p.lead { margin: 6px 0 18px; color: var(--muted); font-size: 14px }

    form { display: grid; grid-template-columns: 1fr; gap: 14px }
    .row { display: grid; grid-template-columns: 1fr; gap: 14px }
    @media (min-width: 700px) { .row { grid-template-columns: 1fr 1fr } }

    label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px }
    .field { position: relative }
    input[type="email"], input[type="text"] {
      width: 100%; padding: 14px 14px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12); background: rgba(10,15,37,.65);
      color: var(--ink); outline: none; box-shadow: 0 0 0 0 var(--ring);
      transition: box-shadow .2s ease, border-color .2s ease, transform .06s ease;
    }
    input:focus { box-shadow: 0 0 0 6px var(--ring); border-color: rgba(110,243,255,.55) }

    .actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 6px }
    .btn {
      appearance: none; border: 0; padding: 12px 16px; border-radius: 12px; cursor: pointer; font-weight: 600;
      color: #0a0f25; background: linear-gradient(180deg, var(--accent-2), var(--accent));
      box-shadow: 0 8px 20px rgba(110,243,255,.35), inset 0 0 0 1px rgba(255,255,255,.3);
      transition: transform .06s ease, filter .2s ease;
    }
    .btn:active { transform: translateY(1px) }
    .btn.secondary { color: var(--ink); background: rgba(255,255,255,.06); box-shadow: inset 0 0 0 1px rgba(255,255,255,.12) }

    .switch { display: inline-flex; align-items: center; gap: 10px; padding: 8px 12px; border-radius: 999px; background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.12) }
    .switch input { accent-color: var(--accent) }

    .log { margin-top: 18px; padding: 16px; border-radius: 16px; background: rgba(10,15,37,.55); border: 1px solid rgba(255,255,255,.08) }
    .log pre { margin: 0; max-height: 260px; overflow: auto; font-size: 12px; line-height: 1.35 }

    .status { display: flex; align-items: center; gap: 8px; font-weight: 600; margin: 6px 0 2px }
    .dot { width: 10px; height: 10px; border-radius: 50% }
    .ok { color: var(--good) } .warn { color: var(--warn) } .bad { color: var(--bad) }
    .dot.ok { background: var(--good) } .dot.warn { background: var(--warn) } .dot.bad { background: var(--bad) }

    $1
    .stats { display:flex; gap:18px; align-items:center; flex-wrap:wrap; margin-top:10px; padding:10px 12px; border-radius:12px; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.12) }
    .stat { display:flex; align-items:center; gap:8px; font-weight:600 }
    .stat small { color: var(--muted); font-weight:400 }
    .stat .chip { padding:4px 8px; border-radius:999px; background: rgba(255,255,255,.07); border:1px solid rgba(255,255,255,.12) }
    .footer a { color: var(--accent-2); text-decoration: none }
  </style>
</head>
<body>
<div class="wrap">
  <div class="app" id="app">
    <div class="title">
      <span class="badge">DEMO / MOCK</span>
      <h1>Mobile Legends: Email Code Login Checker (UI)</h1>
    </div>
    <p class="lead">This single‑file page gives you a clean UI and response handling based on your Node script.
      It runs in the browser and <strong>uses mock responses by default</strong>. If you own a compliant backend,
      you can wire it to your server by changing one line in the JS (see <em>Endpoint</em> section below).</p>

    <form id="form">
      <div class="row">
        <div class="field">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="name@example.com" required />
        </div>
        <div class="field">
          <label for="cn31">CN31 Token</label>
          <input id="cn31" name="cn31" type="text" placeholder="Paste CN31 here" required />
        </div>
      </div>

      $1
        <button class="btn secondary" id="downloadBtn" type="button" disabled>Download valids (.txt)</button>
      $2
    <div class="stats" id="stats">
        <div class="stat"><span class="chip">Valid</span> <span id="validCount">0</span></div>
        <div class="stat"><span class="chip">Invalid</span> <span id="invalidCount">0</span></div>
        <div class="stat"><small>Total</small> <span id="totalCount">0</span></div>
      </div>
    $1

    <div class="log" id="log">
      <div class="status" id="status"><span class="dot" id="statusDot"></span><span id="statusText">Idle</span></div>
      <pre id="output">Waiting…</pre>
    </div>

    <div class="footer">
      <strong>Important:</strong> Browsers enforce CORS and origin policies. Direct calls to third‑party account endpoints usually fail or violate site terms.
      If you have permission and a lawful use‑case, route requests via <em>your own</em> backend and map its JSON to this UI’s format.
    </div>
  </div>
</div>

<script>
  // ——— Settings ————————————————————————————————————————————————————————————
  const ENDPOINT = "/api/ml-login"; // Your backend (if you wire one). Must return {code, message, data?, redirect?}

  // ——— Helpers ————————————————————————————————————————————————————————————
  const $ = (s) => document.querySelector(s);
  const statusDot = $("#statusDot");
  const statusText = $("#statusText");
  const output = $("#output");
  const form = $("#form");
  const emailEl = $("#email");
  const cn31El = $("#cn31");
  const submitBtn = $("#submitBtn");
  const clearBtn = $("#clearBtn");
  $1
  const downloadBtn = $("#downloadBtn");
  const validCountEl = $("#validCount");
  const invalidCountEl = $("#invalidCount");
  const totalCountEl = $("#totalCount");

  let currentEmail = "";
  let validCount = 0, invalidCount = 0;
  const valids = []; // { email, redirect? }

  function updateStats() {
    validCountEl.textContent = String(validCount);
    invalidCountEl.textContent = String(invalidCount);
    totalCountEl.textContent = String(validCount + invalidCount);
    downloadBtn.disabled = valids.length === 0;
  }
  function addValid(email, redirect) {
    validCount++; valids.push({ email, redirect }); updateStats();
  }
  function addInvalid() { invalidCount++; updateStats(); }

  function setStatus(kind, text) {
    statusDot.className = "dot " + (kind || "");
    statusText.textContent = text || "";
  }
  function print(obj) {
    try {
      output.textContent = typeof obj === "string" ? obj : JSON.stringify(obj, null, 2);
    } catch (_) {
      output.textContent = String(obj);
    }
  }

  // ——— Mock engine (mirrors your Node.js handleResponse cases) ——————————
  function mockLogin(email, token) {
    // Simple deterministic picker so the same email yields the same case in a session
    const seed = (email + "|" + token).split("").reduce((a,c)=>((a<<5)-a+c.charCodeAt(0))|0,0);
    const roll = Math.abs(seed % 5);
    switch (roll) {
      case 0: return { code: 0, message: "Error_Success", redirect: "https://example.com/redirect/session" };
      case 1: return { code: 1004, message: "Error_NoAccount" };
      case 2: return { code: 1004, message: "Error_FailedTooMuch" };
      case 3: return { code: 1004, message: "Error_ECaptcha_VerifyFail" };
      default: return { code: 9999, message: "Unknown", info: { hint: "Unhandled demo response" } };
    }
  }

  // ——— UI response mapping (same semantics as your CLI) ————————————————
  function handleResponse(resp) {
    const { code, message } = resp || {};
    if (code === 1004 && message === "Error_NoAccount") {
      addInvalid();
      setStatus("bad", "No account found for this email");
      print(resp);
    } else if (code === 0 && message === "Error_Success") {
      const redirectUrl = resp.redirect || (resp.data && resp.data.redirect);
      addValid(currentEmail, redirectUrl);
      setStatus("ok", "Success");
      print({ success: true, email: currentEmail, redirect: redirectUrl });
    } else if (code === 1004 && message === "Error_FailedTooMuch") {
      addInvalid();
      setStatus("warn", "Too many failed attempts. Your IP/Proxy may be banned");
      print(resp);
    } else if (code === 1004 && message === "Error_ECaptcha_VerifyFail") {
      addInvalid();
      setStatus("warn", "Captcha verification failed");
      print(resp);
    } else {
      addInvalid();
      setStatus("", "Unhandled response");
      print(resp);
    }
  } = resp || {};
    if (code === 1004 && message === "Error_NoAccount") {
      setStatus("bad", "No account found for this email");
      print(resp);
    } else if (code === 0 && message === "Error_Success") {
      const redirectUrl = resp.redirect || (resp.data && resp.data.redirect);
      setStatus("ok", "Success");
      print({ success: true, redirect: redirectUrl });
    } else if (code === 1004 && message === "Error_FailedTooMuch") {
      setStatus("warn", "Too many failed attempts. Your IP/Proxy may be banned");
      print(resp);
    } else if (code === 1004 && message === "Error_ECaptcha_VerifyFail") {
      setStatus("warn", "Captcha verification failed");
      print(resp);
    } else {
      setStatus("", "Unhandled response");
      print(resp);
    }
  }

  // ——— Submit flow ————————————————————————————————————————————————
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    $1
    currentEmail = email;
    if (!email || !cn31) return;

    setStatus("", "Checking…");
    print("Sending…");
    submitBtn.disabled = true;

    try {
      let resp;
      if (mockToggle.checked) {
        // Demo path (no network)
        await new Promise(r => setTimeout(r, 500));
        resp = mockLogin(email, cn31);
      } else {
        // Backend path: Your server should accept { email, e_captcha } and return { code, message, data?, redirect? }
        const r = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, e_captcha: cn31 })
        });
        resp = await r.json();
      }
      handleResponse(resp);
    } catch (err) {
      setStatus("bad", "Request error");
      print({ error: err?.message || String(err) });
    } finally {
      submitBtn.disabled = false;
    }
  });

  $1

  downloadBtn.addEventListener("click", () => {
    if (!valids.length) return;
    const lines = valids.map(v => v.email + (v.redirect ? " => " + v.redirect : ""));
    const blob = new Blob([lines.join("
") + "
"], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "valid-accounts.txt";
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 1000);
  });

  // initialize counters
  updateStats();
</script>
</body>
</html>
